âŸ¨PBM,PPMâŸ©â†â€¢Import"../bqn-graphics/pnm.bqn"
âŸ¨Inferno,Magma,ViridisâŸ©â†â€¢Import"../bqn-graphics/colormaps.bqn"

# Parameters
dtâ€¿daâ€¿dbâ€¿fâ€¿kâ†âŸ¨1.0,0.16,0.08,0.060,0.062âŸ©
nâ†500  # image size
mâ†150  # seed size at the center of the image

# Discrete Laplacian
Laplâ†(+Â´âˆ˜âˆ¾1â€¿Â¯1(âŒ½â‹ˆâŒ½Ë˜)Â¨<)-4âŠ¸Ã—
# Gray-Scott update
UpdateAâ†{ğ•¨+dtÃ—(daÃ—Lapl ğ•¨)+(-ğ•¨Ã—ğ•©â‹†2)+fÃ—1-ğ•¨}
UpdateBâ†{ğ•©+dtÃ—(dbÃ—Lapl ğ•©)+(ğ•¨Ã—ğ•©â‹†2)-ğ•©Ã—k+f}
Updateâ†(UpdateAâ‹ˆUpdateB)Â´

# Initialization
aâ†nâ€¿nâ¥Š1
SquareMaskâ†{ğ•©â€¿ğ•©â†‘(-ğ•¨â€¿ğ•¨+ğ•©Ã·2)â†‘(2Ã—ğ•¨â€¿ğ•¨)â¥Š1}
CircleMaskâ†{(ğ•¨Ã—ğ•¨)â‰¥(âŒ½âˆ˜â‰âˆ¾â‰)(âŒ½âˆ¾âŠ¢)+â—‹(â‹†âŸœ2)âŒœËœâ†•ğ•©Ã·2}
maskâ†(nâ€¿nâ€¢rand.Range 2)Ã—m CircleMask n
bâ†maskâŒˆ0.05Ã—nâ€¿nâ€¢rand.Range 0

# Run
Stepâ†{stepsize ğ•Š iâ€¿aâ€¿b:
  â€¢Show iÃ—stepsize
  apâ€¿bpâ†UpdateâŸstepsize aâ€¿b
  ("out/step"âˆ¾(Â¯5â†‘âˆ¾â€¢FmtÂ¨5-âŠ¸â†‘i)âˆ¾".pnm")â€¢file.Chars (PPM âŒŠ255Ã—>ViridisÂ¨1-a)âˆ¾@+10
  (i+1)â€¿apâ€¿bp
}

50 Stepâ€¢_while_(600âŠ¸>âˆ˜âŠ‘âŠ¢) 0â€¿aâ€¿b
â€¢Out""
